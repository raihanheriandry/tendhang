<div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-lg w-80 p-6 text-center">
    <h2 class="text-lg font-semibold text-gray-800 mb-3">Confirm Delete</h2>
    <p class="text-gray-600 mb-6">Are you sure you want to delete this product?</p>
    <div class="flex justify-center space-x-4">
      <button id="confirmYes" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition">
        Yes, Delete
      </button>
      <button id="confirmNo" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400 transition">
        Cancel
      </button>
    </div>
  </div>
</div>

<script>

    function showConfirmModal() {
  return new Promise((resolve) => {
    const modal = document.getElementById("confirmModal");
    const yesBtn = document.getElementById("confirmYes");
    const noBtn = document.getElementById("confirmNo");

    modal.classList.remove("hidden");

    yesBtn.onclick = () => {
      modal.classList.add("hidden");
      resolve(true);
    };

    noBtn.onclick = () => {
      modal.classList.add("hidden");
      resolve(false);
    };

    modal.onclick = (e) => {
      if (e.target === modal) {
        modal.classList.add("hidden");
        resolve(false);
      }
    };
  });
}


const modal = document.getElementById("confirmModal");

    function openModal() {
      modal.classList.remove("hidden");
    }

    function closeModal() {
      modal.classList.add("hidden");
    }

    function confirmDelete() {
      alert("Produk dihapus!");
      closeModal();
    }

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    async function deleteProduct(productId, deleteUrl) {
    const confirmed = await showConfirmModal();
    if (!confirmed) return;

    const csrfToken = getCookie('csrftoken');

    try {
        const response = await fetch(deleteUrl, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'X-Requested-With': 'XMLHttpRequest'
            },
        });

        if (response.ok) {
            const data = await response.json();

            const productElement = document.getElementById(`product-item-${productId}`);
            if (productElement) {
                productElement.remove();
            }

            showToast(data.message || 'Product deleted successfully!', '', 'success');
            document.dispatchEvent(new CustomEvent('productDeleted'));
        } else {
            const errorData = await response.json();
            showToast(errorData.message || 'Failed to delete product', '', 'error');
        }
    } catch (error) {
        showToast('Terjadi kesalahan jaringan.', '', 'error');
        console.error('Error during AJAX delete:', error);
    }
}

</script>