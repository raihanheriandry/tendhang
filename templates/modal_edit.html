<div 
  id="editModal" 
  class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40 p-6"
>
  <div 
    id="editModalContent" 
    class="bg-yellow-50 rounded-2xl shadow-xl w-[90vw] md:w-[80vw] lg:w-[70vw] 
           transform transition-all duration-150 opacity-0 scale-95 p-6"
  >

    <div class="flex items-center justify-between border-b border-gray-200 pb-3 mb-4">
      <h3 class="text-2xl font-semibold text-gray-900">Edit Product</h3>
      <button 
        type="button" 
        class="text-gray-400 hover:text-gray-900 hover:bg-gray-200 rounded-lg p-1.5" 
        onclick="hideEditModal()"
      >
        <svg aria-hidden="true" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 
             111.414 1.414L11.414 10l4.293 4.293a1 1 0 
             01-1.414 1.414L10 11.414l-4.293 4.293a1 1 
             0 01-1.414-1.414L8.586 10 4.293 
             5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
        </svg>
      </button>
    </div>

    <!-- Body -->
    <form id="editProductForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <input type="hidden" id="edit_product_id" name="product_id">

      <!-- Left Column -->
      <div class="space-y-4">
        <div>
          <label for="edit_name" class="block text-sm font-medium text-gray-700">Name</label>
          <input type="text" id="edit_name" name="name" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-cyan-500 focus:border-cyan-500" required>
        </div>

        <div>
          <label for="edit_description" class="block text-sm font-medium text-gray-700">Description</label>
          <textarea id="edit_description" name="description" rows="4" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-cyan-500 focus:border-cyan-500 resize-none" required></textarea>
        </div>

        <div>
          <label for="edit_category" class="block text-sm font-medium text-gray-700">Category</label>
          <select id="edit_category" name="category" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-cyan-500 focus:border-cyan-500" required>
            <option value="jersey">Jersey Bola</option>
            <option value="shoes">Sepatu Bola</option>
            <option value="ball">Bola</option>
            <option value="accessories">Aksesoris</option>
            <option value="training">Alat Latihan</option>
            <option value="jacket">Jaket</option>
          </select>
        </div>
      </div>

      <!-- Right Column -->
      <div class="space-y-4">
        <div>
          <label for="edit_thumbnail" class="block text-sm font-medium text-gray-700">Thumbnail URL</label>
          <input type="url" id="edit_thumbnail" name="thumbnail" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-cyan-500 focus:border-cyan-500">
        </div>

        <div>
          <label for="edit_price" class="block text-sm font-medium text-gray-700">Price</label>
          <input type="number" id="edit_price" name="price" min="0" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-cyan-500 focus:border-cyan-500">
        </div>

        <div>
          <label for="edit_stock" class="block text-sm font-medium text-gray-700">Stock</label>
          <input type="number" id="edit_stock" name="stock" min="0" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-cyan-500 focus:border-cyan-500">
        </div>

        <div>
          <label for="edit_size" class="block text-sm font-medium text-gray-700">Size</label>
          <input type="text" id="edit_size" name="size" class="mt-1 block w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-cyan-500 focus:border-cyan-500">
        </div>

        <div class="flex items-center pt-2">
          <input id="edit_is_featured" name="is_featured" type="checkbox" class="w-4 h-4 text-cyan-600 border-gray-300 rounded focus:ring-cyan-500">
          <label for="edit_is_featured" class="ml-2 text-sm font-medium text-gray-900">Featured</label>
        </div>
      </div>
    </form>

    <!-- Footer -->
    <div class="flex flex-col sm:flex-row gap-4 mt-8 border-t border-gray-200 pt-5">
      <button type="button" class="order-2 sm:order-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-md font-medium hover:bg-gray-50 transition-colors text-center" onclick="hideEditModal()">Cancel</button>
      <button type="submit" id="submitEdit" form="editProductForm" class="order-1 sm:order-2 flex-1 bg-cyan-600 text-white px-6 py-3 rounded-md font-medium hover:bg-cyan-700 transition-colors">Save Changes</button>
    </div>
  </div>
</div>

<script>
  async function showEditModal(productId) {
    const modal = document.getElementById('editModal');
    const content = document.getElementById('editModalContent');

    const response = await fetch(`/json/${productId}/`);
    if (!response.ok) {
      showToast('Gagal memuat data produk.', '', 'error');
      return;
    }

    const product = await response.json();

    document.getElementById('edit_product_id').value = product.id;
    document.getElementById('edit_name').value = product.name;
    document.getElementById('edit_description').value = product.description;
    document.getElementById('edit_category').value = product.category;
    document.getElementById('edit_thumbnail').value = product.thumbnail;
    document.getElementById('edit_price').value = product.price;
    document.getElementById('edit_stock').value = product.stock;
    document.getElementById('edit_size').value = product.size;
    document.getElementById('edit_is_featured').checked = product.is_featured;

    modal.classList.remove('hidden');
    setTimeout(() => {
      content.classList.remove('opacity-0', 'scale-95');
      content.classList.add('opacity-100', 'scale-100');
    }, 50);
  }

  function hideEditModal() {
    const modal = document.getElementById('editModal');
    const content = document.getElementById('editModalContent');
    content.classList.remove('opacity-100', 'scale-100');
    content.classList.add('opacity-0', 'scale-95');
    setTimeout(() => modal.classList.add('hidden'), 150);
  }

  document.getElementById('editProductForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const id = document.getElementById('edit_product_id').value;

    const formData = new FormData(this);
    const url = `{% url 'main:edit_product_ajax' '00000000-0000-0000-0000-000000000000' %}`
      .replace('00000000-0000-0000-0000-000000000000', id);

    const response = await fetch(url, { method: 'POST', body: formData });

    if (response.ok) {
      hideEditModal();
      showToast('Product updated successfully!', '', 'success');
      document.dispatchEvent(new CustomEvent('productUpdated'));
      
    } else {
      showToast('Failed to update product', '', 'error');
    }
  });
</script>
